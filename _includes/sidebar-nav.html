{% comment %}
  List all content pages that have a layout defined, excluding pages
  with nav_exclude: true. Sorted by optional "order" front matter,
  then alphabetically by title.
{% endcomment %}
{% assign nav_pages = site.pages
     | where_exp: "p", "p.layout != nil"
     | where_exp: "p", "p.nav_exclude != true" %}

{% assign ordered   = nav_pages | where_exp: "p", "p.order != nil" | sort: "order" %}
{% assign unordered = nav_pages | where_exp: "p", "p.order == nil" | sort: "title" %}
{% assign sorted_pages = ordered | concat: unordered %}

<ul>
  {% for nav_page in sorted_pages %}
    {% assign nav_label = nav_page.title | default: nav_page.path | split: "/" | last | split: "." | first | replace: "-", " " | replace: "_", " " | capitalize %}
    {% if nav_page.url == page.url %}
      <li><a href="{{ nav_page.url | relative_url }}" class="active">{{ nav_label }}</a></li>
    {% else %}
      <li><a href="{{ nav_page.url | relative_url }}">{{ nav_label }}</a></li>
    {% endif %}
  {% endfor %}
</ul>
